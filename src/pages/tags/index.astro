---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allPosts = (await getCollection('posts')).filter(p => !p.data.draft);
const tagMap = new Map<string, number>();

allPosts.forEach(post => {
  post.data.tags.forEach(tag => {
    tagMap.set(tag, (tagMap.get(tag) || 0) + 1);
  });
});

const tags = [...tagMap.entries()].sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Tags">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-8">Tags</h1>
    <div class="flex flex-wrap gap-3">
      {tags.map(([tag, count]) => (
        <a
          href={`/tags/${tag.toLowerCase()}/`}
          class="inline-flex items-center gap-1.5 px-4 py-2 bg-gray-50 dark:bg-gray-800 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-sm"
        >
          <span class="text-gray-700 dark:text-gray-300">#{tag}</span>
          <span class="text-xs text-gray-400 dark:text-gray-500">{count}</span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
