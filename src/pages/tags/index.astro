---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allPosts = (await getCollection('posts')).filter(p => import.meta.env.DEV || !p.data.draft);
const tagMap = new Map<string, number>();

allPosts.forEach(post => {
  post.data.tags.forEach(tag => {
    tagMap.set(tag, (tagMap.get(tag) || 0) + 1);
  });
});

const tags = [...tagMap.entries()].sort((a, b) => b[1] - a[1]);
const maxCount = Math.max(...tags.map(t => t[1]));
---

<BaseLayout title="Tags">
  <div class="max-w-4xl mx-auto px-4 py-12 md:py-16">
    <h1 class="text-3xl font-serif font-black tracking-tight mb-10" style="color: var(--text-primary);">Tags</h1>
    <div class="flex flex-wrap gap-3 items-baseline">
      {tags.map(([tag, count]) => {
        const scale = 0.75 + (count / maxCount) * 0.75;
        return (
          <a
            href={`/tags/${tag.toLowerCase()}/`}
            class="font-mono tracking-wider hover-underline transition-colors"
            style={`color: var(--text-secondary); font-size: ${scale}rem;`}
          >
            #{tag}
            <sup class="ml-0.5" style="color: var(--text-muted); font-size: 0.65em;">{count}</sup>
          </a>
        );
      })}
    </div>
  </div>
</BaseLayout>
