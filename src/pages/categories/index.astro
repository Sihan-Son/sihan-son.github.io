---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allPosts = (await getCollection('posts')).filter(p => !p.data.draft);
const categoryMap = new Map<string, number>();

allPosts.forEach(post => {
  post.data.categories.forEach(cat => {
    categoryMap.set(cat, (categoryMap.get(cat) || 0) + 1);
  });
});

const categories = [...categoryMap.entries()].sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Categories">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-8">Categories</h1>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      {categories.map(([cat, count]) => (
        <a
          href={`/categories/${cat.toLowerCase().replace(/[\/\s]/g, '-')}/`}
          class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
        >
          <span class="font-medium text-gray-900 dark:text-white">{cat}</span>
          <span class="text-sm text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-600 px-2 py-0.5 rounded-full">{count}</span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
