---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allPosts = (await getCollection('posts')).filter(p => import.meta.env.DEV || !p.data.draft);
const categoryMap = new Map<string, number>();

allPosts.forEach(post => {
  post.data.categories.forEach(cat => {
    categoryMap.set(cat, (categoryMap.get(cat) || 0) + 1);
  });
});

const categories = [...categoryMap.entries()].sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Categories">
  <div class="max-w-4xl mx-auto px-4 py-12 md:py-16">
    <h1 class="text-3xl font-serif font-black tracking-tight mb-10" style="color: var(--text-primary);">Categories</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {categories.map(([cat, count]) => (
        <a
          href={`/categories/${cat.toLowerCase().replace(/[\/\s]/g, '-')}/`}
          class="group flex items-center justify-between p-4 border-l-3 rounded-r-lg transition-colors"
          style="border-color: var(--accent); background-color: var(--card-bg);"
        >
          <span class="font-serif font-bold" style="color: var(--text-primary);">{cat}</span>
          <span class="font-mono text-xs tracking-wider" style="color: var(--text-muted);">{count}</span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
