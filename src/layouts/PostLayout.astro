---
import BaseLayout from './BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import Giscus from '../components/Giscus.astro';

interface Props {
  title: string;
  date: Date;
  categories?: string[];
  tags?: string[];
  section: string;
  thumbnail?: string | null;
}

const { title, date, categories = [], tags = [], section, thumbnail } = Astro.props;
const displayDate = date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
---

<BaseLayout title={title} image={thumbnail || undefined}>
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Main content -->
      <article class="flex-1 min-w-0">
        <header class="mb-8">
          <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-3">
            <a href={`/${section}/`} class="hover:text-blue-600 dark:hover:text-blue-400 uppercase tracking-wider font-medium">
              {section}
            </a>
            <span>Â·</span>
            <time datetime={date.toISOString()}>{displayDate}</time>
          </div>
          <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white leading-tight">
            {title}
          </h1>
          {categories.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-4">
              {categories.map(cat => (
                <a href={`/categories/${cat.toLowerCase().replace(/[\/\s]/g, '-')}/`} class="px-3 py-1 text-xs font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors">
                  {cat}
                </a>
              ))}
            </div>
          )}
        </header>

        <div class="prose prose-lg dark:prose-invert max-w-none
          prose-headings:text-gray-900 dark:prose-headings:text-white
          prose-a:text-blue-600 dark:prose-a:text-blue-400
          prose-img:rounded-lg prose-img:shadow-md
          prose-pre:bg-gray-50 dark:prose-pre:bg-gray-800
          prose-code:text-pink-600 dark:prose-code:text-pink-400">
          <slot />
        </div>

        {tags.length > 0 && (
          <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
            <div class="flex flex-wrap gap-2">
              {tags.map(tag => (
                <a href={`/tags/${tag.toLowerCase()}/`} class="px-3 py-1 text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                  #{tag}
                </a>
              ))}
            </div>
          </div>
        )}

        <Giscus />
      </article>

      <!-- Sidebar -->
      <Sidebar />
    </div>
  </div>
</BaseLayout>
