---
import BaseLayout from './BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import Giscus from '../components/Giscus.astro';

interface Props {
  title: string;
  date: Date;
  categories?: string[];
  tags?: string[];
  section: string;
  thumbnail?: string | null;
}

const { title, date, categories = [], tags = [], section, thumbnail } = Astro.props;
const displayDate = date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
---

<BaseLayout title={title} image={thumbnail || undefined}>
  <div class="max-w-7xl mx-auto px-4 py-12 md:py-16">
    <div class="flex flex-col lg:flex-row gap-12">
      <!-- Main content -->
      <article class="flex-1 min-w-0">
        <header class="mb-10 max-w-prose">
          <div class="flex items-center gap-3 font-mono text-xs tracking-wider mb-4" style="color: var(--text-muted);">
            <a href={`/${section}/`} class="uppercase hover-underline" style="color: var(--accent-sub);">
              {section}
            </a>
            <span>&middot;</span>
            <time datetime={date.toISOString()}>{displayDate}</time>
          </div>
          <h1 class="text-3xl md:text-4xl font-serif font-black leading-tight tracking-tight" style="color: var(--text-primary);">
            {title}
          </h1>
          {categories.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-4">
              {categories.map(cat => (
                <a href={`/categories/${cat.toLowerCase().replace(/[\/\s]/g, '-')}/`} class="font-mono text-xs tracking-wider px-3 py-1 rounded-full border transition-colors" style={`border-color: var(--border-color); color: var(--accent);`}>
                  {cat}
                </a>
              ))}
            </div>
          )}
        </header>

        <div class="prose prose-lg max-w-prose" style="--tw-prose-body: var(--text-primary); --tw-prose-headings: var(--text-primary);">
          <slot />
        </div>

        {tags.length > 0 && (
          <div class="mt-10 pt-6 border-t max-w-prose" style="border-color: var(--border-color);">
            <div class="flex flex-wrap gap-2">
              {tags.map(tag => (
                <a href={`/tags/${tag.toLowerCase()}/`} class="font-mono text-xs tracking-wider px-3 py-1 rounded-full transition-colors" style={`background-color: var(--bg-secondary); color: var(--text-muted);`}>
                  #{tag}
                </a>
              ))}
            </div>
          </div>
        )}

        <Giscus />
      </article>

      <!-- Sidebar -->
      <Sidebar />
    </div>
  </div>
</BaseLayout>
